<!DOCTYPE html>
<html lang="en">
    <head>
        <title>MakerDAO Chainlog</title>
        <meta charset="UTF-8">
    </head>
    <body>
        <script>
const chainlog = "0xdA0Ab1e0017DEbCd72Be8599041a2aa3bA7e740F";
const hex2a = hexx => { // adapted from https://stackoverflow.com/a/3745677/15857007
  const hex = hexx.toString();
  let str = '';
  for (let i = 0; i < hex.length; i += 2) {
    const ch = hex.substr(i, 2);
    if (ch === '00') continue;
    str += String.fromCharCode(parseInt(ch, 16));
  }
  return str;
}
const call = (params, callback) => {
  const url = 'https://mainnet.infura.io/v3/633f64adbe364bb88127348d4fcc21ef';
  const options = {
    method: 'POST',
    body:   '{"jsonrpc": "2.0", "method": "eth_call", "params": [' + JSON.stringify(params) + ', "latest"], "id": 0 }'
  };
  const promise = fetch(url, options);
  promise.then(response => response.json().then(content => callback(content.result)));
}
const getAddress = (keyHex, callback) => {
  call({
    to: chainlog,
    data: "0x21f8a721" + keyHex // getAddress(bytes32)
  }, callback);
}
const listKeys = data => {
  data = data.substring(2 + 64 * 2);
  const table = document.createElement("table");
  for (let i = 0; i < data.length; i += 64) {
    const tr = document.createElement("tr");

    const tdKey = document.createElement("td");
    const keyHex = data.substring(i, i + 64);
    const key = hex2a(keyHex);
    tdKey.innerHTML = key;
    tr.append(tdKey);

    const tdView = document.createElement("td");
    const view = document.createElement("button");
    view.innerHTML = "view";
    view.addEventListener("click", () => {
      getAddress(keyHex, addressHex => {
        const address = "0x" + addressHex.substring(26);
        tdView.innerHTML = address;
      });
    });
    tdView.append(view);
    tr.append(tdView);

    table.append(tr);
  }
  document.body.append(table);
}
call({
  to:   chainlog,
  data: "0x0f560cd7" // list()
}, listKeys);
        </script>
    </body>
</html>
